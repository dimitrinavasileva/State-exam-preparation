use movies;
-- ???????????? ?????? ?? ??????????

--?????? ?? FULL [outer] join
use movies;
--?? ????? ?????? ?/??? ????????? ?? ?? ?????? ????? ??, ????????? ?? ???? ? networth:
-- ???????? ?????:
SELECT ms.name, me.name, ms.birthdate, me.networth
FROM moviestar ms
FULL outer JOIN movieexec me ON ms.name = me.name;
-- ????? ?????:
SELECT COALESCE(ms.name, me.name) AS name, --COALESCE ---> ????? ??????? NOT NULL ???????? ?? ???????
       ms.birthdate, me.networth
FROM moviestar ms
FULL JOIN movieexec me ON ms.name = me.name;

--1 ?? ????? ??????, ????? ????? ??????? ??????? A ? ????? ???? ??? ?????, ?? ?? ???????: ???, ????? ??????, ? ????? ???????? ? ??????? ????; 
--???? ?? (??????????) ???????, ????? ?? ?????? ??? ?????, ??????? ?? ????????.

select s.name, min(m.year) as fst_year, count(distinct st.starname)
from studio s
join movie m on s.name = m.studioname
join starsin st on m.title = st.movietitle and m.year = st.movieyear
join moviestar mo on st.starname = mo.name
where s.address like '%A%' and mo.gender = 'M'
group by s.name
having count(distinct m.title) >= 2;

--2 ???????? ??????, ????? ??????? ??????? ? ????????? ???? ?? ???? ???????, ????? ?? ?????? ???? ??????? ???????? ?? ???????? (??????-???) ? ????? ?? ?? ??????? ??????? R. 
--????? ?? ?? ??????? ???-??????? ???????, ? ??? ??????? ??????? ???? ??????? ??????? ????, ?? ?? ????? ????????? ?? ??????? ??? ?? ?????.
select name, birthdate
from MOVIESTAR
where name not like '%R%' and gender = 'F' and (MONTH(BIRTHDATE) <= 6 and MONTH(BIRTHDATE) >= 1)
order by birthdate desc, name asc

--3 ?? ????? ??????? ?????? ?? ?? ?????? ???????? ??????????: ???; ???????? ?? ????; ???? ?????, ????? ?? ??????? ? ???????? ?? ????? 
--(??? ???????? ???? ?????? ? ????? ? ???). ??? ?? ?????? ?????? ???? ?????????? ? ??? ????? ? ??????, ?? ??? ?? ?? ?????? ??? ? ??????? ??????: ???, null, 0. 
--??????:
/*??????1 ????1 5
??????1 ????2 0
??????1 ????3 2
??????2 null 0*/
select mo.name, movietitle, count(distinct m.title) as cnt_movies
from moviestar mo 
left join starsin st on mo.name = st.starname
left join movie m on m.title = st.movietitle and m.year = st.movieyear
group by mo.name, st.movietitle

--4 ?? ?? ??????? ????? ? ????????? ???? ?? ?????? ??????? ?????? ? ?????????? ?????, ????? ?? ?? ?????? ??? ???? ?? ????? 
--????? ?????????? ?? 18 ?. ?? ?? ??????? ? ??????, ?? ????? ?????? ?????????? ? ??? ????? ?? ??????.
select NAME, BIRTHDATE
from MOVIESTAR 
where ADDRESS is NULL and NAME not in (select ms.NAME
										from MOVIESTAR ms 
										join STARSIN si on ms.NAME=si.STARNAME 
										join MOVIE m on si.MOVIETITLE=m.TITLE and si.MOVIEYEAR=m.YEAR
										where m.STUDIONAME = 'Disney' and si.MOVIEYEAR-year(ms.BIRTHDATE)<18)


--5 ?? ?? ?????? ??????, ????? ?? ????? ???? ????? ???????? ??????? ??? Star ? ?????????? ? ????? ???????? ?? k
--??????? ???????? ? ???????. ????? ?? ?? ??????? ???-??????? ?????, ? ????? ? ??????? ??????? ?? ????? ????????? ?? ??????? ???
select title, length
from movie
where title like 'Star%' and title not like '%k'
order by length desc, title

--6 ???????? ??????, ????? ??????? ?? ????? ??????
--????? ??
--??????
--? ?????????? ?? ???? ?? ??????? ??, ????? ?? ? ?????????? ??????? ??? ?? ??-????? ?? ???????? ??????? ?? ??????? ?? ?????? ??????
--?????? 
-- MGM MGMBul Movie1
-- MGM MGMBul Movie3
-- Fox FoxBul Movie5
select s.name, s.address, m.title, m.length
from studio s
join movie m on s.name=m.studioname
where length is null or length > (select avg(length)
								  from movie m1
								  where s.name = m1.studioname
								  group by studioname);

--7 ?? ????? ??????, ???????? ? ???-????? 2 ???????? ??????? ??????, ?? ?? ??????:
--??? ?? ??????, ???? ?????? ?????, ???????? ?????? ?? ???-?????? ??????, ? ?????? ? ???????? ????????.
--?? ?? ??????? ? ??????, ????? ????? ????? ??? ?? ??????? ????? ???? ?????????? ??? ?????? ?? ?????? -
-- ?? ??? ?? ?? ??????? ????????? 0 ??? NULL ?? ?????????? ?????
SELECT studio.name, count(distinct title) as cnt, year(min(birthdate)) as year
FROM studio  -- --- ?????? ?? ?????? ?? studio, ?? movie, ?????? ????? ? ?????? ????? ?? ??? ????? !!!
LEFT JOIN movie on studio.name = studioname
LEFT JOIN starsin on year = movieyear and title = movietitle
LEFT JOIN moviestar on starname = moviestar.name
GROUP BY studio.name
HAVING COUNT(DISTINCT starname) <= 2

use pc;

--9 ?? ????? ?????? ?? ?? ?????? ???????? ??????????: ???, ?????, ????????????, ???????? ???? ?? ????????? ??? ????? ???????? ?? ??????. 
--??? ????? ???????????? ?? ?????????? ???????, ?? ???? ?? ?? ?????? ??? ? ??????? ??????: null, null, ???, 0;
select code, laptop.model, maker, coalesce((select avg(price) 
											from laptop l 
											where l.screen = laptop.screen), 0)
from product
left join laptop on product.model = laptop.model;

--10 ?? ????? ????????????, ????? ??? ???? ??? ??????????? ??????? ? ????? ??? ? ???????? ?? ‘A’ ?? ?? ???????: ????? ?? ?????????????, 
--?????? ?? ???-?????? ?? ??????, ???????? ?? ?????? ??????? ? ???????? ??????? ??????.
select maker, max(price), count(distinct screen)
from product
join laptop on product.model = laptop.model
group by maker
having count(code) >= 3 and maker != 'A'

--11 ?? ?? ??????? ????????, ??????????? ?? ???????? ? ?????????? ? ?????? ?? ?????? ???????, ??????????? ?? ????????????, 
---????? ?? ?????????? ?????? ???????? ? ?????????? ????. ?? ?? ??????? ? ?????????, ????? ????????????? ?? ??????????? ??????? ????????. 
--??????????? ? ????????? ?? ? ??????, 1 ??? ? 2.54 ??.
select laptop.model, screen*2.54, price
from product
join laptop on product.model = laptop.model
where maker not in (select maker
					from product 
					join printer on product.model = printer.model
					where color = 'y' and price is null)

use ships;
--12 ?? ?? ??????? ??????? ? ???????? ?? ?????????? ?? ?????? ?????, ? ????? ?? ?? ????????? ????? ?????? ?? ?????????? ???????. 
--??? ????? ?????? ????? ??????? ??????, ????? ?? ????????? ?????? ?? 4 ?????? ????? ???????. 
--?? ?? ??????? ? ???????, ?? ????? ?????? ?????????? ??? ?????? ?? ????????? ? ???.
SELECT DISTINCT name, MONTH(date)
FROM battles 
LEFT JOIN outcomes on name = battle
WHERE ship NOT IN (SELECT name
				   FROM ships 
				   JOIN classes on ships.class = classes.class
				   WHERE launched < year(date) - 4 AND country IS NOT NULL)

--13 ?? ????? ??????? ???? ? 2, 3 ??? 4 ?????? ?? ?? ???????: -???; -?????????? ??????, ? ????? ? ?????? ????? ?? ???? ???? (launched);
-- -???? (????????) ????? ? ????????? ?????? ?? ???? ????.
SELECT classes.class, MAX(launched), COUNT(DISTINCT battle)
FROM classes 
JOIN ships on classes.class = ships.class 
LEFT JOIN outcomes on name = ship
WHERE country = 'Japan'
GROUP BY classes.class
HAVING COUNT(distinct name) IN (2,3,4)

--14 ???????? ??????, ????? ??????? ??????? ? ???? ?????? (numguns) ?? ?????? ??????? ???????, 
--?? ????? ????????????????? (displacement) ? ????? ????????? [10000, 20000] 
--? ????? ?? ??????? ??????? K. ????? ?? ?? ??????? ????????? ? ???-????? ??????, 
--? ??? ??????? ????? ???? ??????? ????, ?? ?? ????? ????????? ?? ???.
select class, count(numguns)
from classes
where country = 'Japan' and (displacement < 10000 or displacement > 20000) and class not like '%K%'
group by class
order by count(numguns), class;

--15 ?? ????? ????? ?? ?? ??????: -??? ?? ?????; -??? ?? ?????, ???????? ? ???????; 
---???? ??????, ??????? ?? ???? ? ?????? ?????? ???? ??????? ?????. 
--??? ?? ?????? ????? ???? ????????? ??????, ?? ?? ??????: ??? ?? ?????, null, 0. 
--??????: ?????1 ?????1 3 ?????1 ?????2 0 ?????1 ?????3 2 ?????2 null 0
SELECT battles.name, ships.name, (SELECT COUNT(*) FROM ships s WHERE s.launched = ships.launched) -- ???? ?? COALESCE(..., 0)
FROM battles 
LEFT JOIN outcomes on battles.name = battle 
LEFT JOIN ships on ship = ships.name

---- ??????? ?? ?????? ?? ???? ?? ????? ?????? ?? ???????? ?????, ???, ????. ?????????? ?????

--16.09.2020
use movies;
--Task 1
-- A)
--?? ?? ?????? ??????, ????? ??????? ??????? ? ???????? ?? ?????? ??????, ????? ???? ???? ???? ?????? ? ???? ???? ?????-??? ????. ?????????? ?? ?? ??????? ????????? ?? ?????.
select s.name, s.address
from studio s
join movie m on s.name = m.studioname
where m.incolor = 'Y'

intersect -- ???????? ??????????? ?? ???????. ? ALL ?? ?? ??????, ?? ALL ?? ?? ???????? ?? SQL Server.

select s.name, s.address
from studio s
join movie m on s.name = m.studioname
where m.incolor = 'N'
order by address;

SELECT DISTINCT S.NAME, S.ADDRESS
FROM STUDIO S 
JOIN MOVIE M on S.NAME = M.STUDIONAME
WHERE M.INCOLOR='Y' AND S.NAME IN (SELECT S.NAME
                                   FROM STUDIO S
                                   JOIN MOVIE M on S.NAME = M.STUDIONAME
                                   WHERE M.INCOLOR='N')
ORDER BY S.ADDRESS;

--????? ??????? ?????? - ???????? ?? ? ?????, ??? ???? ???? ??? ?????? incolor ?? ??????? ???????????? N Y
select s.name, s.address
from studio s
join movie m on s.name = m.studioname
where m.incolor = 'Y' and m.incolor = 'N'
order by s.address;

-- ?)
--?? ?? ?????? ??????, ????? ?? ????? ?????? ? ???-????? ??? ????? ???????:
--•????? ??;
--•??????;
--•???????? ??????? ?? ??????? ?? ???? ??????.
--?????? ??? ????? ???? ?? ?? ??????? (?? ?????? ??????? ?? ?? ??????? null ??? 0).
select s.name, s.address, avg(m.length)
from studio s
left join movie m on s.name = m.studioname
group by s.name, s.address
having count(m.title) <= 3;

--05.08.2020
use movies;
--Task 1
--A)
--?? ?? ?????? ??????, ????? ??????? ??????? ? ????????? ???? ?? ?????? ??????? ??????, ????? ??? ?? ??????? "Jr." ? ?? ?????? ? ???? ???? ?????? ????. 
--????? ?? ?? ??????? ???-??????? ??????,? ??????, ?????? ?? ???? ? ???? ????, ?? ?? ??????? ?? ??????? ???.
select mo.name, mo.birthdate
from moviestar mo
join starsin st on mo.name = st.starname
join movie m on st.movietitle = m.title and st.movieyear = m.year
where mo.name not like '%Jr.%' and m.incolor = 'Y'
order by mo.birthdate desc, mo.name;

--?)
--?? ?? ?????? ??????, ????? ??????? ???????? ?????????? ?? ????? ???????, ?????? ? ???-????? 6 ?????:
--•???;
--•??????? ?????? (????. ??? ????????? ? ?????? ?? 1.1.1995 ?., ? ???????? ?? ???? 1995);
--•???? ???????? ??????, ? ????? ? ????????.
--??? ?? ?????? ??????? ???? ?????????? ? ????? ????? ? ??????, ?? ??? ???? ?? ?? ?????? ??? ? ??????? ??????????, ???? ?? ???? ?????? ?? ?????? 0.

--???-????? 6 ????? => ???? ? 0 ??? ?????? ?????? ?? ?????????? left join 
select mo.name, year(mo.birthdate) as act_year, count(distinct m.studioname) as cnt_studio
from moviestar mo
left join starsin st on mo.name = st.starname
left join movie m on st.movietitle = m.title and st.movieyear = m.year
where mo.gender = 'F'
group by mo.name, mo.birthdate
having count(st.movietitle) <= 6;

--10.09.2019
use movies;
--Task 1
--?? ?? ?????? ??????? ?? ????????, ????? ??????? ?? ????? ????????? ????? ?? ? ???? ?? ??????? ?? ?? ??????. ??????????, ????? ????? ???? ???? ????, 
--?? ?????? ?? ?????????? ? ???????????? ?????????.
--??????? ?
select me.name, m.year, count(*) as cnt
from movieexec me
join movie m on me.cert# = m.producerc#
group by me.cert#, me.name, m.year

--Task 2
--?? ?? ?????? ??????, ????? ?? ?????? ????? ?? ???-??????? ?????? (????? ? ??? ????????).
select name
from moviestar
where birthdate = (select max(birthdate)
				   from moviestar);
					  
--OR

select name
from moviestar
where birthdate >= all(select birthdate
				       from moviestar
					   where birthdate is not null);

--09.07.2019
use movies;
--Task 1 
--?? ?? ?????? ??????? ?? ????????, ????? ??????? ??? ?? ?????? ? ???? ?? ??????? ??, ?? ???? ?????? ? ??-????? ?? ??? ?????. 
--????????, ????? ????? ???? ???? ????, ?? ?????? ?? ?????????? ? ?????????.
--??????? C

--Task 2
--?? ?? ?????? ??????, ????? ?? ?????? ??????? ?? ?????? ?????????? ? ????????? ????? ?????. 
select name
from movieexec
where networth = (select min(networth)
				  from movieexec);

select name
from movieexec
where networth >= all(select networth
				      from movieexec
					  where networth is not null);

--10.09.2018
use ships;
--???. ?? ?????? ???????? ?? ????? ?? ? ??????? ?? ???? ?? ??????? ???????? null, ?? ?? ????? ?? ?????????? not null ???????????

--Task 1
--?? ?? ?????? ??????, ????? ??????? ??? ?? ????, ???????? ?? ??????? ?????, ? ????? ????? ?? ???? ???? ? ????????, ???????? ?? ?????????? ?????, 
--? ????? ????? ?? ???? ???? ? ????????, ? ???? ?? ?????? ???????? ?????, ? ????? ?????? ?? ???? ???? ?? ?????????, ???? ?? ???? ???????, ????????? ? ??????? N. 
--??? ?? ????? ???? ???? ?????, ????? ?? ? ???????? ? ?????, ?? ??????????? ?????? ?? ?? ????? ???????? null.
SELECT S.CLASS, MIN(YEAR(DATE)) AS MIN_YEAR, MAX(YEAR(DATE)) MAX_YEAR, COUNT(DISTINCT B.NAME) AS CNT
FROM SHIPS S 
LEFT JOIN OUTCOMES O on S.NAME = O.SHIP
LEFT JOIN BATTLES B on O.BATTLE = B.NAME
WHERE S.CLASS LIKE 'N%'
GROUP BY S.CLASS;

--Task 2  
--?? ?? ?????? ??????, ????? ?? ?????? ??????? ?? ???? ?????, ?? ????? ????? ?? ???????? ?? ??? 'bb', ????????? ? ???? ?????, ? ??-????? ?? ???? ?? ???????? ?? ??? 'bc', 
--????????? ? ?????? ?????. ?????, ? ????? ?? ? ???????? ???? ???? ?????, ?? ?? ?? ???????? ? ?????????.
SELECT *
FROM
(
SELECT O.BATTLE, COUNT(S.NAME) AS CNT_BB
FROM CLASSES C, SHIPS S, OUTCOMES O
WHERE C.CLASS = S.CLASS AND S.NAME=O.SHIP
AND C.TYPE='bb'
GROUP BY O.BATTLE) T_BB
JOIN
(SELECT O.BATTLE, COUNT(S.NAME) AS CNT_BC
FROM CLASSES C, SHIPS S, OUTCOMES O
WHERE C.CLASS = S.CLASS AND S.NAME=O.SHIP
AND C.TYPE='bc'
GROUP BY O.BATTLE) T_BC
ON T_BB.BATTLE = T_BC.BATTLE
WHERE T_BB.CNT_BB > T_BC.CNT_BC;


SELECT O.BATTLE AS CNT_BB
FROM CLASSES C, SHIPS S, OUTCOMES O
WHERE C.CLASS = S.CLASS AND S.NAME=O.SHIP
AND C.TYPE='bb'
GROUP BY O.BATTLE
HAVING COUNT(S.NAME) > (SELECT COUNT(S1.NAME) AS CNT_BC
                    FROM CLASSES C1, SHIPS S1, OUTCOMES O1
                    WHERE C1.CLASS = S1.CLASS AND S1.NAME=O1.SHIP
                    AND C1.TYPE='bc' AND O1.BATTLE = O.BATTLE
                    GROUP BY O1.BATTLE);

--13.07.2018
use movies;
--Task 1
--?? ?? ?????? ??????, ????? ?? ?????? ??? ?? ??????, ???????? ?? ?????? ???? ?? ???? ??????, ???????? ?? ????????? ???? ?? ???? ?????? ? ???? ?? ?????? ????? ?? ???? ??????, 
--???? ?? ???? ?????? ????????? ? ??????? ‘M’.
SELECT STUDIONAME, MIN(YEAR) AS MIN_YEAR, MAX(YEAR) AS MAX_YEAR, COUNT(*) CNT
FROM MOVIE
WHERE STUDIONAME LIKE 'M%'
GROUP BY STUDIONAME;

--Task 2
--?? ?? ?????? ??????, ????? ?? ?????? ????? ?? ?????????, ????????? ? ???-????? ?????, ? ???? ?? ???????, ? ????? ? ?????????                
SELECT MS.NAME, COUNT(S.MOVIETITLE) AS CNT
FROM MOVIESTAR MS
JOIN STARSIN S ON MS.NAME = S.STARNAME
WHERE MS.NAME = S.STARNAME AND MS.GENDER = 'F'
GROUP BY MS.NAME
HAVING COUNT(*) >= ALL(SELECT COUNT(S.MOVIETITLE) AS CNT
                       FROM MOVIESTAR MS, STARSIN S
                       WHERE MS.NAME = S.STARNAME
                       AND MS.GENDER = 'F'
                       GROUP BY MS.NAME);

--09.09.2017
use ships;
--????????? ?????????? ?????, ?????????? ? ______ ????, ?? ???????? ?? ?????? ??? ? ??????? ?? ????????, ????? ?????? ?? ?? ???????? ? ????? (???? ? ?? ?? ?? ?????????).
SELECT NAME, COUNTRY
FROM SHIPS 
LEFT JOIN OUTCOMES ON NAME = SHIP
LEFT JOIN CLASSES ON CLASSES.CLASS = SHIPS.CLASS
WHERE RESULT <> 'sunk' OR RESULT IS NULL;

--????????? ?????????? ?????, ?????????? ? ______ ????, ?? ???????? ?? ?????? ???, ??????????????? ? ???? ?????? ?? ???-?????? ?????? ? ???-????? ??????.
SELECT NAME, DISPLACEMENT, NUMGUNS
FROM CLASSES C 
JOIN SHIPS S on C.CLASS = S.CLASS
WHERE DISPLACEMENT = (SELECT MIN(DISPLACEMENT) 
					  FROM CLASSES)  AND NUMGUNS = (SELECT MAX(NUMGUNS) 
													FROM CLASSES C1 
													WHERE C.CLASS = C1.CLASS);

--????????? ?????????? ?????, ?????????? ? ______ ????, ?? ???????? ?? ?????? ??? ?? ???????, ? ????? ? ???????? ???? ?????.
SELECT BATTLE, SHIP
FROM OUTCOMES O1
WHERE NOT EXISTS (SELECT * 
				  FROM OUTCOMES O2
                  WHERE O1.BATTLE = O2.BATTLE AND O1.SHIP <> O2.SHIP);

--?? ?? ?????? ????????, ????? ??????? ??? ?? ????? ? ???? ?? ?????????? ? ????? ?????? ?? ?????????? ????, ?? ???? ??????? ? ?????? ?? 5 ??????.
-- ??????? ?
select class, count(distinct name)
FROM ships s 
join outcomes o on s.name=o.ship
where result = 'sunk' and class in (select c.class
									from classes c 
									join ships s on c.class=s.class
									group by c.class
									having count(name) > 5)
group by class;

--11.07.2017
use movies;
--????????? ?????????? ?????, ?????????? ? ______ ????, ?? ???????? ?? ?????? ?? ????? ?????? ????? ?? ????????, ?????????? ? ???????? ?? ?????,
--??????? ???????? ?? ????? ?? ???? ??????.
SELECT STUDIONAME, TITLE, YEAR
FROM MOVIE M
WHERE YEAR = (SELECT MAX(YEAR) 
              FROM MOVIE 
			  WHERE STUDIONAME = M.STUDIONAME);


--????????? ?????????? ?????, ?????????? ? ______ ????, ?? ???????? ?? ?????? ??? ?? ????????? ? ???? ??????? ?? ????????????? ?? ???? ?????, 
--?? ???? ??????????, ????? ???? ???? ???? ???? ????? 1980 ?.
SELECT NAME, SUM(LENGTH) AS SUM_LEN
FROM MOVIEEXEC 
JOIN MOVIE ON PRODUCERC# = CERT#
GROUP BY NAME
HAVING MIN(YEAR) < 1980;


--????????? ?????????? ?????, ?????????? ? ______ ????, ?? ???????? ?? ?????? ??? ?? ?????????, ????????? ??? ????? ?? ?????????? ? ???-?????? ????? ??????, 
--????? ? ???????? ?? ???????, ? ????? ?? ?????????, ??? ?? ????????? ? ????? ??????.
SELECT STARNAME, TITLE, NETWORTH
FROM STARSIN 
JOIN MOVIE ON MOVIETITLE=TITLE AND MOVIEYEAR = YEAR
JOIN (SELECT CERT#, NETWORTH, NAME
      FROM MOVIEEXEC
      WHERE NETWORTH = (SELECT MAX(NETWORTH) FROM MOVIEEXEC))T
ON T.CERT# = PRODUCERC#;

--????????? ??????? ?? ????????, ????? ??????? ????? ?? ??????????, ?????????? ? ???????? ?? ?????? ?????, ??????????? ?? ?????????? ?? ????? ‘Interstellar’.
--??????? ?
select name, title, year
from movie 
join movieexec on producerc#=cert#
WHERE cert# = any (select producerc#
				   from movie
				   where title = 'Interstellar');

--OR:

select name, title, year
from movie 
join movieexec on producerc#=cert#
WHERE cert# in (select producerc#
				from movie
				where title = 'Interstellar');

--9.09.2016
use ships;
--??? ?? ?????? ????????, ????? ??????? ?????? ???????, ????? ???? ???? ???? ?????, ???????? ??????, ????? ? ???? ?? ?????????? ?????? ?? ????? ?? ?????????
-- ?) ?????? - OR result IS NOT NULL ????? ?????? ?????????
-- ????? left join ? classes ? ????? ?????? ???????, ? ?? ???? ???? ????? ???? ???? ????? ?? ? ???????? ? ?????
SELECT c.country , COUNT(o.result)
FROM classes c left join ships s ON c.class=s.class
LEFT JOIN outcomes o ON s.name=o.ship
WHERE result='sunk' OR result IS NOT NULL
GROUP BY c.country;

--??????? ?) ?????
select c.country , count(o.result)
from classes c  
join ships s on c.class=s.class 
join outcomes o on s.name=o.ship
where result='sunk'
group by c.country;

-- ?) ?????? - HAVING ??? GROUP BY ? ORDER BY ?????? ?? ? ???? HAVING
SELECT c.country , COUNT(o.result)
FROM classes c join ships s ON c.class=s.class
JOIN outcomes o ON s.name=o.ship
JOIN battles b ON o.battle=b.name
ORDER BY c.country
HAVING result ='sunk';

-- ?) ?????? - ??? ? ???????, ????? ?????? ?? ?? ????????? ? ?????
SELECT DISTINCT c.country, (SELECT COUNT(o.result)
							FROM classes c1 JOIN ships s ON c1.class=s.class
							JOIN outcomes o ON s.name=o.ship
							WHERE result='sunk' AND c1.country=c.country)
FROM classes c;

--?? ?? ?????? ????????, ????? ??????? ??????? ?? ???????, ????? ?? ??-??????? (? ?????? ?? ?????? ???????) ?? ??????? ? ???????? ???? (Coral Sea)
--??????? ?) ?????
select distinct battle
from outcomes o1
where(select count(distinct country) 
	  from outcomes o,ships s,classes c 
	  where o.ship=s.name and s.class=c.class and battle=o1.battle) 
	 >
	(select count(distinct country) 
	 from outcomes o,ships s,classes c 
	 where o.ship=s.name and s.class=c.class and battle='Coral Sea')

-- ?) ??????
-- from ?? 2 ??????? -> ????????? ????????????
-- ?? ???? (SELECT NumCountries FROM t), ?????? t ? ???????? ???????, ? NumCountries ?????? ?? ???? ???????? ???????
-- ????? join ??? ???? ?? ?? battle ?? outcomes
SELECT DISTINCT battle
FROM OUTCOMES,(SELECT count(DISTINCT country) as NumCountries
               FROM OUTCOMES o, SHIPS s, CLASSES c
			   WHERE o.ship = s.name AND s.class = c.class AND battle = 'Soft Core') as t
HAVING (SELECT count(DISTINCT country)
        FROM OUTCOMES o1, SHIPS s, CLASSES c
		WHERE o1.ship = s.name AND s.class = c.class AND battle = o1.battle) > (SELECT NumCountries
																				FROM t);

-- ?) ??????
-- ?????? ??? ????????? ?? ? count distinct
SELECT DISTINCT battle
FROM OUTCOMES o, SHIPS s, CLASSES c
Where  o.ship = s.name AND s.class = c.class
GROUP BY battle
HAVING COUNT(DISTINCT country) >(SELECT COUNT(country)
                                 FROM OUTCOMES o, SHIPS s, CLASSES c
								 WHERE ship = name AND s.class = c.class AND battle = 'Soft Core');

-- ?) ??????
-- Cross join?
SELECT DISTINCT battle
FROM OUTCOMES o
CROSS JOIN CLASSES c
GROUP BY battle
HAVING COUNT(DISTINCT country) >(SELECT COUNT(DISTINCT country)
                                 FROM OUTCOMES o, CLASSES c
								 WHERE battle = 'Soft Core');

--12.07.2016
use movies;
-- 1. ?? ?? ?????? ????????, ????? ??????? ????? ?? ?????????? ? ??????? ?? ???????, ??????????? ?? ?????????? ?? 'Pretty Woman'.
-- ???????? ? ????? ?? ?????????? ?? ????? ?? ?? ? ????????.

-- ?) ?????
SELECT t.name, title
FROM movie m JOIN (SELECT name, cert#
				   FROM movieexec
				   WHERE cert# IN (SELECT producerc#
								   FROM movie
								   WHERE title='Pretty Woman')) t
ON m.producerc# = t.cert#;

-- ?) ?????? - ????????? ?????? ?? ????? name ? title
SELECT name, title
FROM (SELECT cert#
	  FROM movieexec
	  INTERSECT
	  SELECT producerc#
	  FROM movie
      WHERE title='Pretty Woman')t

-- ?) ?????? - ??????? ???? ?????????? ?? Pretty Woman
SELECT name, title
FROM movie m 
JOIN movieexec me ON m.producerc# = me.cert#
WHERE title='Pretty Woman';

-- ?) ?????? - ??????? ????, ????? ?? ?? ??????????? ?? ????
SELECT name, title
FROM movie m 
LEFT JOIN movieexec me ON m.producerc# = me.cert#
WHERE me.cert# NOT IN (SELECT producerc#
					   FROM movie
					   WHERE title='Pretty Woman');

-- 2. ?? ?? ?????? ????????, ????? ?? ?????????, ????????? ? ???­-????? ????? ?? ??????????? ??????, ??????? ??? ?? ??????, ??? ?? ?????? ? ???? ?????, ? ????? ? ???????? ????????.
-- ? ????????? ?? ?????? ?? ?? ???????? ?????, ?? ????? ????? ?? ???????? ?? ? ????????.

-- ?) ?????? - ????????? COUNT ? HAVING 
--HAVING COUNT ?? ????????? (???? ? ?? ?? ?????? ???? HAVING (SELECT COUNT(starname)..., ?? ????? ????? ????? ?? ???????? ? ???? MAX(starname) 
SELECT studioname, starname, COUNT(starname)
FROM movie JOIN starsin ON title=movietitle AND year=movieyear
WHERE studioname IS NOT NULL
GROUP BY studioname, starname
HAVING COUNT(SELECT starname
			 FROM movie, starsin
			 WHERE title = movietitle AND year = movieyear) >=
	   MAX(starname);

-- ?) ?????? - ????????? COUNT ? HAVING
SELECT studioname, starname, COUNT(starname)
FROM movie m 
LEFT JOIN starsin ON title=movietitle AND year=movieyear
WHERE studioname IS NOT NULL
GROUP BY studioname, starname
HAVING COUNT(SELECT starname
			 FROM movie, starsin
			 WHERE title=movietitle
			 AND year=movieyear)>=ALL(SELECT COUNT(*)
									  FROM movie, starsin
									  WHERE title=movietitle
									  AND year=movieyear
									  GROUP BY studioname, starname);
-- ?) ?????? - ????? ????? ?? ?????? ?????? ?? ?????
SELECT studioname, starname, COUNT(DISTINCT starname)
FROM movie m JOIN starsin ON title=movietitle AND year=movieyear
WHERE studioname IS NOT NULL
GROUP BY m.studioname, starname
HAVING COUNT(starname)>=ALL(SELECT COUNT(DISTINCT starname)
							FROM movie,starsin
							WHERE title=movietitle
							AND year=movieyear
							AND studioname=m.studioname
							GROUP BY studioname, starname);
-- ?) ?????
SELECT studioname, starname, COUNT(*)
FROM movie m JOIN starsin ON title=movietitle AND year=movieyear
WHERE studioname IS NOT NULL
GROUP BY studioname, starname
HAVING COUNT(*)>=ALL(SELECT COUNT(*)
					 FROM movie,starsin
					 WHERE title=movietitle
			 		 AND year=movieyear
					 AND studioname=m.studioname
					 GROUP BY studioname ,starname);

--10.09.2015
use movies;
--?? ?? ?????? ????????, ????? ??????? ??????? ? ???????? ?? ?????? ??????? ?? ?????, ????? ? ?? ?????? ??????? ?????? ?? ?????. ??????????? ?? ?? ????????? ?? ?????.
-- ?) ?????? - ??????? ??????? ? ?????? ? ??????? ?????? (???????? ? ?????? ?????? ?? ?? ?? ??????? ?????)
SELECT MS.name, MS.address
FROM MovieStar AS MS
JOIN Studio S ON MS.address =S.address
WHERE MS.address LIKE '%Sofia%'AND gender = 'F'
ORDER BY MS.address

-- ?) ?????
select *
from (select name, address
	  from MovieStar
	  where gender = 'F'
	 union
	  select name, address
	  from Studio) T
where T.address like '%Sofia%'
order by T.address

--?? ? ???????, ?????? ?? ???? ???????? ? ?? ???????? ? ?? ???????? ??? ?? ???????? ??????? ????? ?????? ?? ???????? ---> ???? ? ???? ????? ?? ?? ??? ? ? ???????? ?? ???????? ? ? ???????? ?? ????????
select name, address
from MovieStar
where gender = 'F'and address like '%Sofia%'

union 

select name, address
from Studio
where address like '%Sofia%'
order by address;

-- ?) ?????? - ? ??????? ?????? ???? ??????????? ?? ?? ?? ????? order by ????? union ?
SELECT name, address
FROM MovieStar MS
WHERE gender = 'F'
ORDER BY address
UNION 
SELECT name, address
FROM Studio
WHERE address LIKE '%Sofia%'
ORDER BY address

-- ?) ?????? - MovieStar INTERSECT Studio
SELECT DISTINCT name, address
FROM MovieStar INTERSECT Studio
WHERE address IS NOT NULL AND gender LIKE 'F'
GROUP BY address
HAVING address LIKE '%Sofia%'

-- ?) ?????? - JOIN???? ????????? (JOIN ????? ?????? ? ??????? Non sense)
SELECT DISTINCT name, address
FROM MovieStar
FULL JOIN Studio ON address LIKE '%Sofia%' 
WHERE gender LIKE 'F'
ORDER BY address?

--2. ?? ?? ?????? ????????, ????? ?? ????? ?????? ? ???-????? ??? ?????­???? ????? ??????? ????? ??, ?????? ? ???????? ??????? ?? ??????? (??? ???????? ???? ?? ??????) 
--?? ???? ??????. ?????? ??? ????? ???? ?? ?? ????????.
-- ?) ?????? - COUNT(inColor = 'y') (?????? ???? ?? ?/? ????? ?? ? <= 3 ?? ?? ????????)
SELECT name, address, AVG(length) AS avgLength
FROM Studio
LEFT JOIN Movie ON name = studioName
GROUP BY studioName, address
HAVING COUNT(inColor = 'y') <= 3;

-- ?) ?????? - ????????? ???????????? ?? ?????????? ?????? ? ????????? ?? ??????? ??????
-- ?? ???? ???? ?? ?? ???????? ?????? ?? ???????? ???????
SELECT DISTINCT name, address, avgLength
FROM Studio, (SELECT studioName, AVG(length) AS avgLength
			  FROM Movie
			  GROUP BY studioName) Averages
WHERE NAME = ANY (SELECT studioName
				  FROM Movie
				  WHERE inColor = 'n'
				  GROUP BY studioName
				  HAVING COUNT(title) <= 3)

-- ?) ?????? - HAVING - ??????????? ????? ???? ?? ?????-???? ?????, ?????????? ?? ????????
SELECT Studio.name, Studio.address, AVG(Movie.length) AS avgLength
FROM Movie
RIGHT JOIN Studio ON studioName = name
GROUP BY name, address
HAVING (SELECT COUNT(*) FROM Movie WHERE inColor = 'n') <= 3

-- ?) ?????
SELECT name, address, AVG(length) AS avgLength
FROM Studio
LEFT JOIN Movie ON name = studioName
WHERE NAME NOT IN (SELECT studioName
				   FROM Movie
				   WHERE inColor = 'n'
				   GROUP BY studioName
				   HAVING COUNT(*) > 3)
GROUP BY name, address;

--14.07.2015
use movies;
--?? ?e ?????? ????????, ????? ??????? ??????? ?? ?????? ??????? ??????,????? ??? ?? ???????? ?? “?” ? ?? ?????? ????? ? ??????, ???? ? ? ?????­???? ?????.
-- ?) ?????? - name != ?????? name LIKE; ???? ?? ????? ????, ?????? ???? ???????????? 'y' ? 'n' ?? incolor
SELECT name
FROM MovieStar, StarsIn, Movie
WHERE name=starName AND movieTitle=title AND movieYear=year AND name != '%a' AND inColor = 'y' AND inColor = 'n'

-- ?) ?????? - 'y' OR 'n' ?? ????? ?????? ????? (?? ????? ?? ? NULL)
-- inColor = 'y' OR inColor = 'n' ???? ???? ?????? ?? ? ?????
SELECT MovieStar.name
FROM MovieStar
WHERE NOT (name LIKE '%a') AND name IN (SELECT starName
										FROM StarsIn
										JOIN Movie ON movieTitle = title AND movieYear = year
										WHERE inColor = 'y' OR inColor = 'n')

-- ?) ?????? - AND starName = (...) ?????? ?? ? AND starName IN (...)
SELECT DISTINCT starName
FROM StarsIn
INNER JOIN Movie ON movieTitle = title AND movieYear = year
WHERE starName NOT LIKE '%a' AND inColor = 'y'AND starName = (SELECT starName
															  FROM StarsIn, Movie
															  WHERE inColor = 'n')

-- ?) ?????
select starName
from StarsIn
join Movie on movieTitle = title and movieYear = year
where starName not like '%a' and inColor = 'y'

intersect

select starName
from StarsIn
join Movie on movieTitle = title and movieYear = year
where inColor = 'n'

-- 2.???????? ????????, ????? ??????? ?? ????? ??????? ??????, ?????? ? ???­-????? 5 ?????, ???????? ??????????:
--­????
--­??????? ???????
--­???? ??????, ? ????? ? ????????.
--??? ?? ?????? ?????? ???? ?????????? ? ????? ????? ? ??????, ?? ??? ???? ?? ?? ??????? ???(? ???? ??????, ????? ?? 0).
-- ???? ???? ?? ?????????? ???????? ?? ???????? ?? ? ?????

--?)?????? - birthdate.year ?? ? ??????? -> YEAR(birthdate)
SELECT DISTINCT name, birthdate.year, COUNT(studioName)
FROM MovieStar, StarsIn, Movie
WHERE name = starname AND((movieTitle=title AND movieYear=year) OR title IS NULL)
GROUP BY name, birthdate.year
HAVING COUNT(title) <= 5

--?)?????? - ????????? ???? ?? ???, ?? ????????? birthdate
SELECT name, YEAR(birthdate), COUNT(DISTINCT studioName)
FROM MovieStar LEFT OUTER JOIN StarsIn ON name = starname LEFT JOIN Movie ON movieTitle = title AND movieYear = year
GROUP BY name
HAVING COUNT(title) <= 5;

--?)?????? - ????????? ???? ?? ???, ?? ????????? birthdate ? ???? ? ???? ?? join-????? ?
SELECT StarsIn.starname, YEAR(birthdate), COUNT(DISTINCT studioName)
FROM Movie JOIN StarsIn ON movieTitle = title AND movieYear = year RIGHT OUTER JOIN MovieStar ON MovieStar.name = StarsIn.starname
GROUP BY StarsIn.starname
HAVING COUNT(DISTINCT title) <= 5;

--?) ?????? having ??? group (order by ? ???????? ?????? group by)
SELECT name, year(birthdate), COUNT(SELECT DISTINCT studioName
									FROM Movie JOIN StarsIn ON title = movieTitle AND year = movieYear
									WHERE starname = name)
FROM MovieStar
HAVING COUNT(SELECT * 
				FROM StarsIn 
				WHERE starname = name) <= 5
ORDER BY name, year(birthdate);


--11.9.2014
use ships;
--1. ???????? ??????? ?? ????????, ????? ??????? ??????? ?? ?????? ??????, ??????? ?? ???? ? ??????, ? ????? ? ????? ????? (?? ? ???????????? ??????? ?? ? ???????? ? ???).

--??????? ? - ?? ? ?????, ?????? ??? ????????? ??????? ? where count(*)
select name 
from ships 
where launched = any(select year(date)
					from battles
					where count(*)>=1);

--??????? ? - ????? ???????
select distinct ships.name
from battles, ships
where launched=year(date);

--??????? ? - ?? ? ????? -- ????? ?? ????? ?????? ??????
select name
from battles 
where exists(select distinct *
			 from ships 
			 where year(date)=launched);

--??????? ? - ?? ? ????? ??? ???? name ?? ? ???? ???? ? ?? ships ??? battles
select distinct name 
from ships
join battles on launched=year(date);

--2. ???????? ??????? ?? ????????, ????? ?? ?????? ???????, ????? ???? ???-????? 3 (?????????? 0) ??????, ??????? ????? ?? ????????? ? ???? ???????? ?????? ??
--(????? ???? ???? ?? ???? 0). 
-- ?) ?????? - ?????? ? result is null
select country,count(result)
from classes c 
left join ships s on c.class=s.class
left join outcomes o on s.name=o.ship
where o.result='sunk'
group by country 
having count(ship)<=3;

-- ?) ?????? - count(result is 'sunk') ? ????????? ??????? ? where
select country,count(result is 'sunk')
from ships,classes,outcomes
where count(ship)<=3 or ship is null;

-- ?) ?????? - ???????? ?????? ?? ???????? ??????? ? main select ? ?????? ?? ? left join
select distinct classes.country,sunk_cnt
from classes
right join (select country,count(*) as sunk_cnt
			from classes c join ships s on c.class=s.class
			join outcomes o on s.name=o.ship
			where result='sunk'
			group by country)sunk on classes.country=sunk.country
where sunk_cnt<=3;

-- ?) ?????? - count(result = 'sunk') ? sunk_cnt ?? ? ???????? ????? ?
select country,count(result= 'sunk') as sunk_cnt
from ships s 
join outcomes o on s.name=o.ship
right join classes c on s.class=c.class
where count(*)<=3
group by country,sunk_cnt;

--??????? ? ????? 
select distinct country, (select count(*)
							from classes c2 join ships s on c2.class=s.class join outcomes o on s.name=o.ship
							where c2.country=c.country and result='sunk')
from classes c 
where(select count(*) from classes c2 join ships s on c2.class=s.class where c2.country=c.country)<=3;

--15.07.2014
use pc;
-- 1. ???????? ??????? ?? ????????, ????? ??????? ?????? ????????????? ?? ???????? ????????, ????? ??????????? ? ???????.
-- ?) ?????
select distinct maker
from product 
where product.type='PC'and maker in(select maker
                                    from product 
									join laptop on product.model=laptop.model);

-- ?) ?????? - ?????????? join
select maker 
from product p1
cross join product p2 
where p1.maker=p2.maker and p1.type='PC'and p2.type='Laptop'
group by maker;

--	***????????? ?????? 
						select p1.maker 
						from product p1
						join product p2 on p1.maker = p2.maker
						where p1.maker=p2.maker and p1.type='PC'and p2.type='Laptop'
						group by p1.maker;

-- ?) ?????? - ???? ??? type ???????????? ?? ? PC / Laptop
select distinct maker 
from product 
where type='PC'and type='Laptop';

-- ?) ?????? - ?????? ?? ?????????? intersect 
-- ?? ?????? ?????? ????????????? ???????????? PC OR Laptop, ? ?????? AND
select maker 
from product
where type='PC'
union
select maker
from product
where type='Laptop';

--2. ???????? ??????? ?? ????????, ????? ??????? ????????, ???????? ? ????????? ?? ???????? ?? ?????? ???????, ????? ????????????? ???? ?? ?????? ?? ??? ?????? ???????? (?????????? 0).

-- ? ?????? - where maker is ..
select code,model,screen
from laptop,product 
where maker is having count(printer.model)<=3;

--? ?????? - ?????? group by ? count(select*...
select code,l.model,screen
from product p 
left join laptop l on p.model=l.model
having count(select*
		     from product 
			 where maker=p.maker and type='Printer')<=3;

--??????? ? - ????????
select code,l.model,screen
from laptop l
inner join product p on l.model=p.model
where maker not in(select maker 
				   from product
				   where type='Printer'
				   group by maker 
				   having count(*)>3);
				   
--? ?????? - ??????????????? ????? ?? ??????????? ????????? ?? ????????? ??? ??  where type='Printer' ? ?? ???? ?????
-- ?? ?????? ???? ?? ?????????? ? ????????? ?? ???????????
select l.code,l.model,l.screen
from laptop l 
join product p on l.model=p.model
where maker in(select maker
			   from product 
			   where type='Printer'
			   group by maker 
			   having count(*)<=3); --count(*) - ???? ? ?????? ? ????? ??? null ????????? 

--? ?????????? - ?????? left join ? ? group by ??????? l.model,l.screen
select l.code,l.model,l.screen
from product p 
left join laptop l on p.model=l.model
left join printer on p.model=printer.model
group by l.code
having count(distinct printer.code)<=3;

--08.09.2010
use movies;
-- Task 1
--?? ?? ?????? ????????, ????????? ?????? ???????, ????? ?? ?? ?????? ? ???? ???? ???? ? ???, ????????? ? ??????? ?.
--???????, ?? ????? ? ?????? ?? ????? ???? ?????????? ?? ??????? ???????, ???? ?????? ?? ????? ????????.

--? ?????? -  ?????? ?? ? MOVIETITLE LIKE 'A%'
--??? ?? ? ?????? ??? ?????
SELECT DISTINCT NAME 
FROM MOVIESTAR  
LEFT JOIN STARSIN ON NAME = STARNAME 
WHERE GENDER = 'F' AND MOVIETITLE NOT LIKE 'A%';

--? ?????? - ???????, ?? ????? ? ?????? ?? ????? ???? ?????????? ?? ??????? ???????, ???? ?? ????? ????????.
SELECT NAME 
FROM MOVIESTAR 
JOIN STARSIN ON STARNAME = NAME 
WHERE GENDER = 'F' AND MOVIETITLE LIKE 'A%' 
GROUP BY NAME 
HAVING COUNT(*) = 0

--? ????????
SELECT MS.NAME 
FROM MOVIESTAR MS 
WHERE MS.GENDER = 'F' AND NOT EXISTS (SELECT 1      
									  FROM STARSIN SI
									  WHERE SI.STARNAME = MS.NAME AND SI.MOVIETITLE LIKE 'A%')

--? - ?????? - WHERE NOT MOVIETITLE LIKE 'A%'
--??? ?? ? ?????? ??? ?????
SELECT NAME 
FROM MOVIESTAR
WHERE GENDER = 'F' AND NAME IN(SELECT DISTINCT STARNAME    
							   FROM STARSIN    
							   WHERE NOT MOVIETITLE LIKE 'A%')

--Task 2
--?? ?? ?????? ????????, ????? ?? ????? ??????? ?????? (??? ???????? ?? ????), ?????? ????? 1990 ?., ??????? ?????????, ?? ????? ? ?????? ?? ????? ??? ??? ????. 
--??????, ?? ????? ???? ?????????? ?? ??????? ??????? ??? ?????, ?? ?????? ?? ????? ?????????. --> inner join 

--? ????????
SELECT NAME, MIN( MOVIEYEAR - YEAR(BIRTHDATE) ) AS DEBUT_AGE 
FROM MOVIESTAR 
JOIN STARSIN ON NAME = STARNAME 
WHERE YEAR(BIRTHDATE) < 1990 
GROUP BY NAME; 

--? ?????????? ??????? - ? group by ?????? birthdate. ??? ?? ???????? ???? ???? ?? ? ??????? ???????
SELECT NAME, MIN(MOVIEYEAR) - YEAR(BIRTHDATE) AS DEBUT_AGE 
FROM MOVIESTAR 
JOIN STARSIN ON NAME = STARNAME 
WHERE YEAR(BIRTHDATE) < 1990 
GROUP BY NAME

--? ?????????? - ? group by ?????? bithdate.?? ??????? ???????? ????????? "??????, ?? ????? ???? ?????????? ?? ??????? ??????? ??? ?????, ?? ?????? ?? ????? ?????????."
--???? ??? left join ? on ????? ????????? ?? ??????? ???????, ? ?????? ????????? YEAR(BIRTHDATE) < 1990 ? ?? ?????? ??????? => ???? ??????? ?????? ?? ? ? where 
SELECT NAME, MIN(MOVIEYEAR) - YEAR(BIRTHDATE) AS DEBUT_AGE 
FROM MOVIESTAR 
LEFT JOIN STARSIN ON NAME = STARNAME AND YEAR(BIRTHDATE) < 1990 
GROUP BY NAME 
HAVING MIN(MOVIEYEAR)

--? ?????????? -  ?? ??????? ???????? ????????? ?? ????? ? ?????? ?? ????? ??? ? having ?? ???????? ???? ? group by
SELECT DISTINCT MS.NAME, MOVIEYEAR - YEAR(BIRTHDATE) AS DEBUT_AGE 
FROM MOVIESTAR MS, STARSIN 
WHERE MS.NAME = STARNAME AND YEAR(BIRTHDATE) < 1990
HAVING MOVIEYEAR <= ALL (SELECT MOVIEYEAR                         
                         FROM STARSIN SI
						 WHERE SI.STARNAME = MS.NAME); 

--15.07.2010
use ships;
--Task 1
--???????? ????????, ????? ??????? ?????? ???????, ????? ???? ????? ??????? ? ??-????? ?? 9 ??????(numguns), ???? ? ??????? ? ??? 12 ??????:
--??????? ? - ?????? - ???????????? >12 ? <9
SELECT DISTINCT COUNTRY 
FROM CLASSES 
WHERE NUMGUNS<9 AND NUMGUNS>12

--????? ?? ? ????:
SELECT DISTINCT COUNTRY 
FROM CLASSES 
WHERE NUMGUNS<9 
intersect
SELECT DISTINCT COUNTRY 
FROM CLASSES 
WHERE NUMGUNS>12

--? ???????? (Self join)
SELECT DISTINCT C1.COUNTRY 
FROM CLASSES C1 
JOIN CLASSES C2 ON C1.COUNTRY=C2.COUNTRY 
WHERE C1.NUMGUNS<9 AND C2.NUMGUNS>12; 

--?) ?????? - ?????? ?? ? ???????
SELECT COUNTRY, NUMGUNS 
FROM CLASSES 
WHERE NUMGUNS<9 
UNION 
SELECT COUNTRY, NUMGUNS 
FROM CLASSES 
WHERE NUMGUNS>12; 

--?) ?????? COUNTRY = (SELECT COUNTRY 
--***???????? ? COUNTRY in (SELECT COUNTRY) ? ???????????? >12 ? <9
SELECT DISTINCT COUNTRY 
FROM CLASSES
WHERE NUMGUNS<9 and COUNTRY = (SELECT COUNTRY  
							   FROM CLASSES  
							   WHERE NUMGUNS > 12);
--Task2
--???????? ????????, ????? ?? ????? ???????, ????????? ? ?? ?????? ?? 4 ?????, ??????? ????? ? ? ???? ?????, ? ????? ? ?????????.
--??? ?????? ??????? ???? ???? ???? ????? ??? ?? ? ????????? ? ???? ???? ?????, ?? ??? ?? ??????? 0.

--A ?????? - ?? ??????? ?????? "??? ?????? ??????? ???? ???? ???? ????? ??? ?? ? ????????? ? ???? ???? ?????, ?? ??? ?? ??????? 0. "
SELECT COUNTRY, COUNT(DISTINCT BATTLE)
FROM CLASSES C, SHIPS S, OUTCOMES O 
WHERE C.CLASS=S.CLASS AND S.NAME=O.SHIP 
GROUP BY COUNTRY 
HAVING COUNT(DISTINCT O.BATTLE)<4

--? ?????? -  distinct battles
SELECT COUNTRY, COUNT(O.BATTLE) AS NUM_BATTLES 
FROM CLASSES C
LEFT JOIN SHIPS S ON C.CLASS=S.CLASS 
LEFT JOIN OUTCOMES O ON S.NAME=O.SHIP 
GROUP BY COUNTRY 
HAVING COUNT(O.BATTLE)<4;

--?) ?????
SELECT COUNTRY, COUNT(DISTINCT BATTLE) 
FROM OUTCOMES 
JOIN SHIPS ON NAME=SHIP 
RIGHT JOIN CLASSES ON CLASSES.CLASS=SHIPS.CLASS 
GROUP BY COUNTRY 
HAVING COUNT(DISTINCT OUTCOMES.BATTLE)<=3; 

--?) ?????? - ?????? distinct ? count, ?????? group by ???? group by 
--?? ??????? ?????? "??? ?????? ??????? ???? ???? ???? ????? ?? ??? ?? ??????? 0. "" 
SELECT C.COUNTRY, COUNT(O.BATTLE) 
FROM CLASSES AS C 
INNER JOIN SHIPS AS S ON C.CLASS=S.CLASS 
LEFT OUTER JOIN OUTCOMES AS O ON S.NAME=O.SHIP 
WHERE COUNT(O.BATTLE)<=3;

--13.09.2008
use ships;
--Task 1
--???????? ????????, ????? ??????? ?? ????? ???? ???????? ?? ???-????? ? ???-????? ???????? ?? ???? ?????

--A ?????? - ?????? group by c.class;
select c.class,min(ss.launched), max(ss.launched) 
from classes c 
join ships ss on ss.class = c.class;

--??????? ? ????????
select c.class,min(ss.launched), max(ss.launched) 
from classes c 
join ships ss on ss.class = c.class
group by c.class;

--c) ?????? - having min(ss.launched) and max(ss.launched); ?????? ?? ??? ?????? ????????
select c.class,min(ss.launched), max(ss.launched) 
from classes c 
join ships ss on ss.class = c.class
group by c.class
having min(ss.launched) and max(ss.launched);

--d) ?????? - ?????? group by c.class; ? ?? ???? ?? ????
select c.class,min(ss.launched) 
from classes c 
join ships ss on ss.class = c.class

union all 

select c.class,max(ss.launched) 
from classes c 
join ships ss on ss.class = c.class


--Task 2
--???????? ????????, ????? ??????? ?????????/????????? ? ???-????? ???????

--a) ?????? - ????????? ??????? ? where 
--???? distinct ?? country ? ???? ??? ?? ?? ????? c.class ?.?. 
--????????? ?????? ?? ????????? ??? ?? ??? ?? ????? ?????? ?? c.class ? ? ?????? 1
select c.country 
from classes c 
where not exists  ( select *  
					from classes c1  
					where c1.country != c.country and count(c1.class) > count(c.class) );

--b) ?????? - max(count(c.class)) - ?????? ?? ??? ?????? ????????
select c.country 
from classes c    
group by c.country 
having max(count(c.class));

--c) ?????? - max(count(c1.class)) ? ????????? ??????? ? where
select c.country 
from classes c 
where count(*) = (select max(count(c1.class))
				  from classes c1  
				  group by c1.country )
group by c.country;

--??????? D) ????????
select c.country 
from classes c 
group by c.country 
having count(*) >= all ( select count(*)
						 from classes c1 
						 group by c1.country );

--08.07.2008
--Task 1
--???????? ????????, ????? ??????? ??????? ?? ???????, ? ????? ???? ??????? ??????–?????? ????????? ?? ????????

--? ?????? - ???? ?????, ? ????? ??? ????????
select distinct b.name
from Battles b 
join Outcomes o on b.name = o.battle 
where o.result = 'sunk';

--B ?????? - ?????????? ????????? ?? ???? ????? ???? 1 ??????? ?????
select o.battle 
from Outcomes o  
group by o.battle,o.result
having o.result = 'sunk';

--C ????? ?? o.battle  = o1.battle and o.ship = o1.ship???
select distinct o.battle 
from Outcomes o 
left join Outcomes o1 on o.battle  = o1.battle and o.ship = o1.ship and o1.result = 'sunk'
group by o.battle 
having count(o.ship) = count(o1.ship);

--D ?????? - ???? ??????, ? ????? ???? ???????? ??????
select o.battle  
from Outcomes o 
group by o.battle  
having count(case when o.result = 'sunk' then 'Y' end)=0;
